TITLE NAVAL
.MODEL SMALL
.STACK 100h
.DATA
P1 db "Zavala:$"
P2 db "Budbung:$"
P3 db "Thephbutr:"
WELCOME db "Boas Vindas Reiyks, eu os invoquei nesse mundo para testa-los como estrategistas.$"
WELCOME2 db "Apos seculos de confrontos, Asahi nao tem recursos mais para sustentar essa guerra.$"
WELCOME3 db "A funcao de voces e acabar com isso, agora! O melhor vence, e toma meu lugar como divindade.$"
INITRULES db "Agora vamos as regras:$"
RULES1 db "1. Suas forcas ja estao reduzidas, mas seu General vai ajuda-lo.$"
RULES2 db "2. Os estrategistas agirao de forma intercalada, cuidado com espioes!$"
RULES3 db "3. O Desafio acaba quando a frota de um dos lados for destruido.$"
TRANS db "Quando ambos estiverem prontos, pressionem qualquer tecla para seguirmos.$"
TRANS2 db "Muito Bem, pelo visto conheceram seus generais, agora colocarei voces no confronto, Que venca o melhor!$"
TRANS22 db "Pressionem qualquer tecla para seguirmos.$"
GEN1MSG db "Ola Reiyk! Meu nome e Zavala, e serei seu General.$"
GEN1MSG2 db "Lembre-se, nos estamos em guerra, e a pessoa que esta no seu lado e seu inimigo, cuidado!$"
GEN1MSG3 db "Antes do confronto final se iniciar, precisamos posicionar nossos navios.$"
GEN1MSG4 db "A Frota sera posicionada em quadrantes divididos em 6 linhas e  6colunas.$"
GEN1MSG5 db "Digite no formato (LETRANUMERO) para dar a ordem, senhor.$"
GEN1MSG6 db "Posicao invalida, senhor.$"
GEN1MSG7 db "Ja posicionou neste quadrante senhor.$"
GEN1MSG8 db "Um tiro certeiro!$"
GEN1MSG9 DB "Nao foi dessa vez senhor.$"
GEN1MSG10 db "Navio ja afundado senhor.$"
GEN2MSG db "Hunpf...Eu, Budbung, Servi a vida inteira para ter que obedecer uma crianca...$"
GEN2MSG2 db "Deixa eu ser claro com voce, se meus homens morrerem por sua causa, eu terei prazer em te matar.$"
GEN2MSG3 db "O inimigo esta do seu lado, entra presta a atencao seu #$%#&%#!$"
GEN2MSG4 db "Nossos navios estao posicionados em 6 linhas e 6 colunas.$"
GEN2MSG5 db "Digite no formato (LETRANUMERO) para dar a ordem. Agora, se vira Espertao.$"
GEN2MSG6 db "Esta fora do campo seu inutil!$"
GEN2MSG7 db "Vai empilhar a minha frota?!$"
GEN2MSG8 db "Derrubou o filho da @#&%!!!$"
GEN2MSG9 db "Mira direito caolho!$"
GEN2MSG10 db "Esse dai ja foi pro inferno!$"
ORDEM db " Qual a sua ordem:$"
VITORIA1 db "Reiyk 1 Venceu e se tornou a nova divindade de Asahi!$"
VITORIA2 db "Reiyk 2 Venceu e se tornou a nova divindade de Asahi!$"
MATRIZ1 db "Sua Frota:$"
MATRIZ2 db "Frota Inimiga:$"
LEGENDA1 db "1-Navio posicionado$"
LEGENDA2 db "2-Navio afundado$"
LEGENDA3 db "3-Erro$"
LEGENDA4 db "4-Desconhecido"
COLUNAS db "   1  2  3  4  5  6$"
LINHAS db 'A'
CP1 db 36 DUP(0)
CP2 db 36 DUP(0)
AP1 db 36 DUP(0)
AP2 db 36 DUP(0)
POSICAO DB ?
SETCONT1 db 0
SETCONT2 db 0
PRINTCOLUNA db 0
PRINTLINHA db 0
LIFE1 db 5
LIFE2 db 5
.CODE
MOV AX, @DATA
MOV DS,AX

JMP FIMPROC

PRINT PROC
MOV AH,9
INT 21H
RET
PRINT ENDP

SPACE PROC
MOV AH,2
MOV DL,32
INT 21H
INT 21H
RET
SPACE ENDP

LIMPA_TELA PROC
MOV AX,0003h
INT 10h
MOV AX,4f02h
MOV BX,103h
INT 10h
	RET
LIMPA_TELA ENDP

PULA PROC
	MOV AH,2
	MOV DL,0DH
	INT 21H
	MOV DL,0AH
	INT 21H
RET
PULA ENDP


IMP PROC
CALL PRINT
CALL PULA
RET 
IMP ENDP

CONFLINHA1 PROC
CONFLINHAINI:
MOV AH,1
INT 21H
CMP AL,64
JA TESTE1
LEA DX,GEN1MSG6
CALL IMP
LEA DX,ORDEM
CALL PRINT
JMP CONFLINHAINI
TESTE1:
CMP AL,71
JB CONFLINHAFIM
LEA DX,GEN1MSG6
CALL IMP
LEA DX,ORDEM
CALL PRINT
JMP CONFLINHAINI
CONFLINHAFIM:

RET
CONFLINHA1 ENDP

CONFLINHA2 PROC
CONFLINHAINI2:
MOV AH,1
INT 21H
CMP AL,64
JA TESTE2
LEA DX,GEN2MSG6
CALL IMP
LEA DX,ORDEM
CALL PRINT
JMP CONFLINHAINI2
TESTE2:
CMP AL,71
JB CONFLINHAFIM2
LEA DX,GEN2MSG6
CALL IMP
LEA DX,ORDEM
CALL PRINT
JMP CONFLINHAINI2
CONFLINHAFIM2:

RET
CONFLINHA2 ENDP

CONFCOLUNA1 PROC
CONFCOLUNAINI:
MOV AH,1
INT 21H
CMP AL,48
JA TESTE1A
LEA DX,GEN1MSG6
CALL IMP
LEA DX,ORDEM
CALL PRINT
JMP CONFCOLUNAINI
TESTE1A:
CMP AL,55
JB CONFCOLUNAFIM
LEA DX,GEN1MSG6
CALL IMP
LEA DX,ORDEM
CALL PRINT
JMP CONFCOLUNAINI
CONFCOLUNAFIM:
SUB AL,49
RET
CONFCOLUNA1 ENDP

CONFCOLUNA2 PROC
CONFCOLUNAINI2:
MOV AH,1
INT 21H
CMP AL,47
JA TESTE2A
LEA DX,GEN2MSG6
CALL IMP
LEA DX,ORDEM
CALL PRINT
JMP CONFCOLUNAINI2
TESTE2A:
CMP AL,55
JB CONFCOLUNAFIM2
LEA DX,GEN2MSG6
CALL IMP
LEA DX,ORDEM
CALL PRINT
JMP CONFCOLUNAINI2
CONFCOLUNAFIM2:
SUB AL,49
RET
CONFCOLUNA2 ENDP

GETORDEM1 PROC
CALL PULA
LEA DX,ORDEM
CALL PRINT
CALL CONFLINHA1
SUB AL,65
MOV BX,6
MUL BX
MOV POSICAO,AL
CALL CONFCOLUNA1
ADD POSICAO,AL

RET
GETORDEM1 ENDP

GETORDEM2 PROC
CALL PULA
LEA DX,ORDEM
CALL PRINT
CALL CONFLINHA2
SUB AL,65
MOV BX,6
MUL BX
MOV POSICAO,AL
CALL CONFCOLUNA2
ADD POSICAO,AL
RET
GETORDEM2 ENDP

SETNAVIO1 PROC
SETNAVIO1INI:
XOR BX,BX
MOV BL,POSICAO
CMP CP1[BX],1
JNE NAVOK
LEA DX,GEN1MSG7
CALL IMP
CALL GETORDEM1
JMP SETNAVIO1INI
NAVOK:
MOV CP1[BX],1
RET
SETNAVIO1 ENDP

SETNAVIO2 PROC
SETNAVIO2INI:
XOR BX,BX
MOV BL,POSICAO
CMP CP2[BX],1
JNE NAVOK2
LEA DX,GEN2MSG7
CALL IMP
CALL GETORDEM2
JMP SETNAVIO2INI
NAVOK2:
MOV CP2[BX],1
RET
SETNAVIO2 ENDP

ATK12 PROC
LEA DX,P1
CALL PRINT
CALL GETORDEM1
XOR BX,BX
MOV BL,POSICAO
CMP CP2[BX],1
JNE ERRO1
CMP AP1[BX],0
JNE TESTEATK1
MOV AP1[BX],2
DEC LIFE2
MOV CP2[BX],2
CALL PULA
LEA DX,GEN1MSG8
CALL IMP
JMP ATK1FIM
TESTEATK1:
CMP AP1[BX],2
JNE ERRO11

ERRO1:
CALL PULA
LEA DX,GEN1MSG9
CALL IMP
MOV AP1[BX],3
JMP ATK1FIM2

ERRO11:

CALL PULA
LEA DX,GEN1MSG10
CALL IMP
JMP ATK1FIM2



ATK1FIM:
CMP LIFE2,0
JNE ATK1FIM2
CALL FIM1
ATK1FIM2:
RET
ATK12 ENDP


ATK21 PROC
LEA DX,P2
CALL PRINT
CALL GETORDEM2
XOR BX,BX
MOV BL,POSICAO
CMP CP1[BX],1
JNE ERRO2
CMP AP2[BX],0
JNE TESTEATK2
MOV AP2[BX],2
DEC LIFE1
MOV CP1[BX],2
CALL PULA
LEA DX,GEN2MSG8
CALL IMP
JMP ATK2FIM
TESTEATK2:
CMP AP2[BX],2
JNE ERRO21

ERRO2:
CALL PULA
LEA DX,GEN2MSG9
CALL IMP
MOV AP2[BX],3
JMP ATK2FIM2

ERRO21:

CALL PULA
LEA DX,GEN2MSG10
CALL IMP
JMP ATK2FIM2

ATK2FIM:
CMP LIFE1,0
JNE ATK2FIM2
CALL FIM2

ATK2FIM2:
RET
ATK21 ENDP

PRINTAM1 PROC

MOV DL,CP1[BX]
ADD DL,48
MOV AH,2
INT 21H
RET
PRINTAM1 ENDP

PRINTAM12 PROC

MOV DL,AP1[BX]
ADD DL,48
MOV AH,2
INT 21H
RET
PRINTAM12 ENDP

PRINTAM2 PROC

MOV DL,CP2[BX]
ADD DL,48
MOV AH,2
INT 21H
RET
PRINTAM2 ENDP

PRINTAM22 PROC

MOV DL,AP2[BX]
ADD DL,48
MOV AH,2
INT 21H
RET
PRINTAM22 ENDP

FIM1 PROC
CALL LIMPA_TELA
LEA DX,VITORIA1
CALL IMP
MOV AH,1
INT 21H
MOV AH,4CH
INT 21H
RET
FIM1 ENDP

FIM2 PROC
CALL LIMPA_TELA
LEA DX,VITORIA2
CALL IMP
MOV AH,1
INT 21H
MOV AH,4CH
INT 21H
RET
FIM2 ENDP

FIMPROC:
;INTRODUÇÃO
CALL LIMPA_TELA
LEA DX,P3
CALL IMP
LEA DX,WELCOME
CALL IMP
LEA DX,WELCOME2
CALL IMP
LEA DX,WELCOME3
CALL IMP
LEA DX,INITRULES
CALL IMP
LEA DX,RULES1
CALL IMP
LEA DX,RULES2
CALL IMP
LEA DX,RULES3
CALL IMP
LEA DX,TRANS
CALL IMP
MOV AH,1
INT 21H
;MONTAGEM JOGADOR 1
CALL LIMPA_TELA
LEA DX,P1
CALL IMP
LEA DX,GEN1MSG
CALL IMP
LEA DX,GEN1MSG2
CALL IMP
LEA DX,GEN1MSG3
CALL IMP
LEA DX,GEN1MSG4
CALL IMP
LEA DX,GEN1MSG5
CALL IMP
LOOPSET1:
CALL GETORDEM1
CALL SETNAVIO1
INC SETCONT1
CMP SETCONT1,5
JB LOOPSET1
;MONTAGEM JOGADOR 2
CALL LIMPA_TELA
LEA DX,P2
CALL IMP
LEA DX,GEN2MSG
CALL IMP
LEA DX,GEN2MSG2
CALL IMP
LEA DX,GEN2MSG3
CALL IMP
LEA DX,GEN2MSG4
CALL IMP
LEA DX,GEN2MSG5
CALL IMP
CALL PULA

LOOPSET2:
CALL GETORDEM2
CALL SETNAVIO2
INC SETCONT2
CMP SETCONT2,5
JNE LOOPSET2

;TRANSIÇÃO JOGADAS
CALL LIMPA_TELA
LEA DX,P3
CALL IMP
LEA DX,TRANS2
CALL IMP
LEA DX,TRANS22
CALL IMP
MOV AH,1
INT 21H
CALL LIMPA_TELA

;Fase de ataques

FASEATK:
CALL LIMPA_TELA
XOR BX,BX
MOV PRINTLINHA,0
MOV PRINTCOLUNA,0
LEA DX,MATRIZ1
CALL IMP
LEA DX,COLUNAS
CALL IMP

INITPRINTCOLUNALINHA1:
MOV DL,LINHAS
MOV AH,2
INT 21H
INITPRINTCOLUNA1:
CALL SPACE
CALL PRINTAM1
INC PRINTCOLUNA
INC BX
CMP PRINTCOLUNA,6
JB INITPRINTCOLUNA1
MOV PRINTCOLUNA,0
CALL PULA
INC PRINTLINHA
INC LINHAS
CMP PRINTLINHA,6
JB INITPRINTCOLUNALINHA1

CALL PULA

MOV PRINTCOLUNA,0
MOV PRINTLINHA,0
MOV LINHAS, 'A'
XOR BX,BX
LEA DX,MATRIZ2
CALL IMP
LEA DX, COLUNAS
CALL IMP
INITPRINTCOLUNALINHA12:
MOV DL,LINHAS
MOV AH,2
INT 21H
INITPRINTCOLUNA12:
CALL SPACE
CALL PRINTAM12
INC PRINTCOLUNA
INC BX
CMP PRINTCOLUNA,6
JB INITPRINTCOLUNA12
MOV PRINTCOLUNA,0
CALL PULA

INC PRINTLINHA
INC LINHAS
CMP PRINTLINHA,6
JB INITPRINTCOLUNALINHA12

LEA DX,LEGENDA1
CALL IMP
LEA DX,LEGENDA2
CALL IMP
LEA DX,LEGENDA3
CALL IMP
LEA DX,LEGENDA4
CALL IMP
CALL ATK12
MOV AH,1
INT 21H

CALL LIMPA_TELA

MOV PRINTCOLUNA,0
MOV PRINTLINHA,0
MOV LINHAS, 'A'
XOR BX,BX
LEA DX, MATRIZ1
CALL IMP
LEA DX,COLUNAS
CALL IMP
INITPRINTCOLUNALINHA21:
MOV DL,LINHAS
MOV AH,2
INT 21H
INITPRINTCOLUNA21:
CALL SPACE
CALL PRINTAM2
INC PRINTCOLUNA
INC BX
CMP PRINTCOLUNA,6
JB INITPRINTCOLUNA21
CALL PULA

MOV PRINTCOLUNA,0
INC PRINTLINHA
INC LINHAS
CMP PRINTLINHA,6
JB INITPRINTCOLUNALINHA21
CALL PULA

MOV PRINTCOLUNA,0
MOV PRINTLINHA,0
XOR BX,BX
LEA DX, MATRIZ2
CALL IMP
LEA DX,COLUNAS
CALL IMP
INITPRINTCOLUNALINHA22:
MOV DL,LINHAS
MOV AH,2
INT 21H
INITPRINTCOLUNA22:
CALL SPACE
CALL PRINTAM22
INC BX
INC PRINTCOLUNA
CMP PRINTCOLUNA,6
JB INITPRINTCOLUNA22
MOV PRINTCOLUNA,0
CALL PULA

INC LINHAS
INC PRINTLINHA
CMP PRINTLINHA,6
JB INITPRINTCOLUNALINHA22
CALL PULA
LEA DX,LEGENDA1
CALL IMP
LEA DX,LEGENDA2
CALL IMP
LEA DX,LEGENDA3
CALL IMP
LEA DX,LEGENDA4
CALL IMP
CALL ATK21
MOV AH,1
INT 21H

JMP FASEATK

FIM:
MOV AH,4CH
INT 21H
END